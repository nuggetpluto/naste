{% extends "base.html" %}
{% block content %}

<h2>–ó–∞–∫—É–ø–∫–∏</h2>

{% if user.role in ["manager", "director"] %}
<p>
    <a href="/purchases/add" class="btn">‚ûï –ù–æ–≤–∞—è –∑–∞–∫—É–ø–∫–∞</a>
</p>
{% endif %}

<!-- –§–æ—Ä–º–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
<form method="get" class="form-inline" style="margin-bottom: 20px; display:flex; gap:10px; flex-wrap:wrap;">

    <select name="supplier" class="form-control">
        <option value="">–í—Å–µ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∏</option>
        {% for s in suppliers %}
            <option value="{{ s.supplier }}" {% if supplier_value == s.supplier %}selected{% endif %}>
                {{ s.supplier }}
            </option>
        {% endfor %}
    </select>

    <select name="status" class="form-control">
        <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
        <option value="–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞" {% if status_value == "–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞" %}selected{% endif %}>–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞</option>
        <option value="–û–∂–∏–¥–∞–Ω–∏–µ" {% if status_value == "–û–∂–∏–¥–∞–Ω–∏–µ" %}selected{% endif %}>–û–∂–∏–¥–∞–Ω–∏–µ</option>
        <option value="–î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ" {% if status_value == "–î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ" %}selected{% endif %}>–î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ</option>
    </select>

    <button class="btn btn-primary" type="submit">–ü–æ–∏—Å–∫</button>

    {% if supplier_value or status_value %}
        <a href="/purchases" class="btn" style="margin-left:10px;">–°–±—Ä–æ—Å–∏—Ç—å</a>
    {% endif %}
</form>

<table>
    <thead>
    <tr>
        <th>‚Ññ</th>
        <th>–°–æ—Ç—Ä—É–¥–Ω–∏–∫</th>
        <th>–ü–æ—Å—Ç–∞–≤—â–∏–∫</th>
        <th>–î–∞—Ç–∞ –∑–∞—è–≤–∫–∏</th>
        <th>–°—Ç–∞—Ç—É—Å</th>
        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
    </tr>
    </thead>

    <tbody>
    {% for p in purchases %}
        <tr>
            <td>{{ loop.index }}</td>
            <td>{{ p.employee_name }}</td>
            <td>{{ p.supplier }}</td>
            <td>{{ p.request_date.strftime("%d.%m.%Y") }}</td>
            <td>{{ p.status }}</td>
            <td>
                <a href="/purchases/{{ p.id }}">üìÑ –û—Ç–∫—Ä—ã—Ç—å</a>
            </td>
        </tr>
    {% endfor %}

    {% if purchases|length == 0 %}
        <tr>
            <td colspan="6" style="text-align:center; color:#777;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td>
        </tr>
    {% endif %}
    </tbody>
</table>

{% endblock %}